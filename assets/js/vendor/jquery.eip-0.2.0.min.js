(function(b){var s=0;b.fn.eip=function(d,g){var a={target:d};b.extend(a,b.fn.eip.defaults,g);var f=function(a,b){return"jeip-"+b+"-"+a.getAttribute("data-jeip-id")},n=function(c){c=b(c);c.attr("title",a.hint_text);b.trim(c.html()).length||(c.addClass(a.empty_class),c.html(a.empty_text));c.bind(a.edit_event,function(){var c=this,j=b(c);j.unbind(a.edit_event);j.removeClass(a.mouseover_class);j.fadeOut("fast",function(){var h=j.hasClass(a.empty_class)?"":j.html();"function"===typeof a.prepare_value&&
(h=a.prepare_value(h));c._eipInitialValue=h;var e;e=h.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/"/g,"&quot;");e=e.replace(/'/g,"&#39;");var m=!1,i=a.template(a.start_form,{id:f(c,"editor"),editor_class:a.editor_class});if("text"==a.form_type)i+=a.template(a.text_form,{id:f(c,"edit"),editfield_class:a.editfield_class,value:e});else if("textarea"==a.form_type){for(var p=h.length,d=p/a.cols+2,g=0;g<p;g++)"\n"==h.charAt(g)&&d++;d>a.max_rows&&(d=a.max_rows);!1!=a.rows&&(d=a.rows);d=parseInt(d);
i+=a.template(a.textarea_form,{id:f(c,"edit"),cols:a.cols,rows:d,editfield_class:a.editfield_class,value:e})}else"select"==a.form_type&&(i+=a.template(a.start_select_form,{id:f(c,"edit"),editfield_class:a.editfield_class}),b.each(a.select_options,function(b,e){var d="";e==h&&(d='selected="selected"');h==e&&(m=b);i+=a.template(a.select_option_form,{id:f(c,"edit-option-"+b),option_value:b,option_text:e,selected:d})}),i+=a.template(a.stop_select_form,{}));i+=a.template(a.form_buttons,{save_id:f(c,"save"),
cancel_id:f(c,"cancel"),savebutton_class:a.savebutton_class,savebutton_text:a.savebutton_text,cancelbutton_class:a.cancelbutton_class,cancelbutton_text:a.cancelbutton_text,or_text:a.or_text});i+=a.template(a.stop_form,{});e=b(i).css("display","none");j.after(e);b("#"+f(c,"editor")).fadeIn("fast");e=b("#"+f(c,"edit"));a.cancel_on_blur&&e.blur(function(){k(c)});e.keydown(function(b){if(27==b.which&&a.cancel_on_esc)return k(c),!1;if(13==b.which&&"textarea"!=a.form_type)return q(c,m),!1});b("#"+f(c,"cancel")).bind("click",
function(){k(c)});b("#"+f(c,"save")).bind("click",function(){return q(c,m)});r(c)})})},r=function(c){var d=b("#"+f(c,"edit")),c=b("#"+f(c,"editor"));a.focus_edit&&d.focus();a.select_text&&d.select();"function"===typeof a.on_show&&c.each(function(){a.on_show.call(this)})},k=function(c){var d=b(c);b("#"+f(c,"editor")).fadeOut("fast",function(){"function"===typeof a.on_hide&&a.on_hide.call(this);b(this).remove();a.mouseover_class&&d.removeClass(a.mouseover_class);d.fadeIn("fast")});n(c)},l=function(c,
d,j){var h=b(c),e=b("#"+f(c,"editor"));if(a.is_error(d,j)){var g=b("#"+f(c,"editor"));b("#"+f(c,"saving")).fadeOut("fast",function(){b(this).remove();g.fadeIn("fast",function(){r(this);"function"===typeof a.on_error&&a.on_error.call(g.get(0),d,j)})})}else{var i=b("#"+f(c,"edit")).attr("value");e.fadeOut("fast",function(){"function"===typeof a.on_hide&&a.on_hide.call(this);b(this).remove();b("#"+f(c,"saving")).fadeOut("fast",function(){b(this).remove();var e;e="select"==a.form_type?b("#"+f(c,"edit-option-"+
i)).html():i;"function"===typeof a.process_value&&(e=a.process_value(e,d));b.trim(e).length?h.removeClass(a.empty_class):(h.addClass(a.empty_class),e=a.empty_text);h.html(e);a.mouseover_class&&h.addClass(a.mouseover_class);h.fadeIn("fast");"function"===typeof a.after_save&&a.after_save.call(c,d,j);a.mouseover_class&&h.removeClass(a.mouseover_class)});n(c)})}},q=function(c,d){b(c);var j=b("#"+f(c,"edit")).val();if(c._eipInitialValue==j)return k(c),!0;var h=b(a.template(a.saving,{id:f(c,"saving"),saving_class:a.saving_class,
saving_text:a.saving_text}));b("#"+f(c,"editor")).after(h.css("display","none")).fadeOut("fast",function(){h.fadeIn("fast")});var e={};e[a.name]=j;var g={url:location.href,name:a.name,form_type:a.form_type,orig_value:c._eipInitialValue,new_value:j,data:a.data};"select"==a.form_type&&(g.orig_option_value=d,g.orig_option_text=g.orig_value,g.new_option_text=b("#"+f(c,"edit-option-"+j)).html());b.isFunction(a.prepare_data)&&b.extend(e,a.prepare_data(g));b.isFunction(a.target)?(j=a.target.call(null,e),
l(c,j)):a.target?b.ajax({url:a.target,type:a.method,dataType:"json",data:e,success:function(a,b,d){l(c,a,d)},error:function(a){var d=null;try{d=b.parseJSON(a.responseText)}catch(e){}l(c,d,a)}}):l(c,null,null)};this.each(function(){var c=b(this);a.mouseover_class&&c.bind("mouseenter mouseleave",function(){b(this).toggleClass(a.mouseover_class)});c.attr("data-jeip-id",s++);n(this)})};b.fn.eip.defaults={name:"value",method:"POST",save_on_enter:!0,cancel_on_esc:!0,cancel_on_blur:!1,focus_edit:!0,select_text:!1,
edit_event:"click",select_options:!1,data:!1,form_type:"text",size:!1,max_size:60,rows:!1,max_rows:10,cols:60,savebutton_text:"SAVE",savebutton_class:"jeip-savebutton",cancelbutton_text:"CANCEL",cancelbutton_class:"jeip-cancelbutton",mouseover_class:!1,editor_class:"jeip-editor",editfield_class:"jeip-editfield",hint_text:"Click to edit",or_text:"OR",empty_text:"(Click to edit)",empty_class:"jeip-empty",saving_text:"Saving ...",saving_class:"jeip-saving",saving:'<span id="#{id}" class="#{saving_class}">#{saving_text}</span>',
start_form:'<span id="#{id}" class="#{editor_class}">',form_buttons:'<span><input type="button" id="#{save_id}" class="#{savebutton_class}" value="#{savebutton_text}"/> #{or_text} <input type="button" id="#{cancel_id}" class="#{cancelbutton_class}" value="#{cancelbutton_text}"/></span>',stop_form:"</span>",text_form:'<input type="text" id="#{id}" class="#{editfield_class}" value="#{value}"/> <br/>',textarea_form:'<textarea cols="#{cols}" rows="#{rows}" id="#{id}" class="#{editfield_class}">#{value}</textarea> <br/>',
start_select_form:'<select id="#{id}" class="#{editfield_class}">',select_option_form:'<option id="#{id}" value="#{option_value}" #{selected}>#{option_text}</option>',stop_select_form:"</select>",after_save:function(){for(var d=b(this),g=0;2>g;++g)d.fadeOut("fast"),d.fadeIn("fast")},is_error:function(b){return b&&b.error},on_error:function(b){alert("Error: "+b.error)},on_show:null,on_hide:null,prepare_data:null,prepare_value:null,process_value:null,template:function(b,g){return b.replace(/#\{([^{}]*)}/g,
function(a,b){return"string"===typeof g[b]||"number"===typeof g[b]?g[b]:a})}}})(jQuery);
