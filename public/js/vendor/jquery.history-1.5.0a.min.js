(function(c){c.History?window.console&&window.console.warn("$.History has already been defined..."):c.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},extractHash:function(a){return a.replace(/^[^#]*#/,"").replace(/^#+|#+$/,"")},getState:function(){return c.History.state},setState:function(a){var b=c.History;a=b.extractHash(a);b.state=a;return b.state},getHash:function(){return c.History.extractHash(window.location.hash||location.hash)},setHash:function(a){a= c.History.extractHash(a);"undefined"!==typeof window.location.hash?window.location.hash!==a&&(window.location.hash=a):location.hash!==a&&(location.hash=a);return a},go:function(a){var b=c.History;a=b.extractHash(a);var d=b.getHash(),f=b.getState();a!==d?b.setHash(a):(a!==f&&b.setState(a),b.trigger());return!0},hashchange:function(a){a=c.History;var b=a.getHash();a.go(b);return!0},bind:function(a,b){var d=c.History;b?("undefined"===typeof d.handlers.specific[a]&&(d.handlers.specific[a]=[]),d.handlers.specific[a].push(b)): d.handlers.generic.push(a);return!0},trigger:function(a){var b=c.History;"undefined"===typeof a&&(a=b.getState());var d,f,g,e;if("undefined"!==typeof b.handlers.specific[a])for(e=b.handlers.specific[a],d=0,f=e.length;d<f;++d)g=e[d],g(a);e=b.handlers.generic;d=0;for(f=e.length;d<f;++d)g=e[d],g(a);return!0},start:function(){c.History.domReady();return!0},configure:function(a){var b=c.History;b.options=c.extend(b.options,a);return!0},domReadied:!1,domReady:function(){var a=c.History;if(!a.domReadied)return a.domReadied= !0,a.$window=c(window),a.$window.bind("hashchange",this.hashchange),setTimeout(a.hashchangeLoader,200),!0},nativeSupport:function(a){return"onhashchange"in window},hashchangeLoader:function(){var a=c.History;if(a.nativeSupport())a.getHash()&&a.$window.trigger("hashchange");else{var b;if(-1===navigator.userAgent.toLowerCase().indexOf("msie")||window.opera)b=function(){var b=a.getHash();a.getState()!==b&&a.$window.trigger("hashchange")};else{a.$iframe=c('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0]; a.$iframe.contentWindow.document.open();a.$iframe.contentWindow.document.close();var d=!1;b=function(){var b=a.getHash(),c=a.getState(),e=a.extractHash(a.$iframe.contentWindow.document.location.hash);c!==b?(d||(a.$iframe.contentWindow.document.open(),a.$iframe.contentWindow.document.close(),a.$iframe.contentWindow.document.location.hash=b),d=!1,a.$window.trigger("hashchange")):c!==e&&(d=!0,a.setHash(e))}}setInterval(b,200)}return!0}}})(jQuery);
